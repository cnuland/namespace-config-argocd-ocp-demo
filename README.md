# Namespace Config Operator with ArgoCD Demo (OCP 4.x)
Demo using ArgoCD and the Namespace Config Operator to automate onboarding for OCP 4.x environments.

## Overview
This demo uses the [Namespace Config Operator](https://github.com/redhat-cop/namespace-configuration-operator) and [ArgoCD](https://argoproj.github.io/projects/argo-cd) to show an end to end solution for onboarding a new project and the nessesary resources needed for day 1 operations. The use of an automated approach for syncing an LDAP group to a `Group` in OCP 4.x, simular to the approach shown [here](https://docs.openshift.com/container-platform/4.3/authentication/ldap-syncing.html), is aslo assumed.

## Utilizing Go Templates

The Namespace Config Operator utilizes [go templates](https://golang.org/pkg/text/template/) to allow the templating of resources generated by the operator. It can use metadata from the `Group` resource as shown in the [examples](https://github.com/redhat-cop/namespace-configuration-operator/blob/master/examples/team-onboarding/group-config.yaml). There are times the `Group` name may follow a different pattern than the name that will be used for the ``Namespace``. An example would be the `Group` name being *AI_Team* but the project name is *SalesLearning*, which the `Namespace` name should match. This can be resolved by adding a label within the `Group` that the `GroupConfig` can reference as followed `{{ index .Labels "projectname" }}`.

```
apiVersion: redhatcop.redhat.io/v1alpha1
kind: GroupConfig
metadata:
  name: team-onboarding
spec:
  labelSelector:
    matchExpressions:
    - {key: projectname operator: Exists}  
  templates:
    - objectTemplate: |
        apiVersion: v1
        kind: Namespace
        metadata:
          name: {{ index .Labels "projectname" }}-dev
        labels:
          team: {{ .Name }}
    - objectTemplate: |
        apiVersion: rbac.authorization.k8s.io/v1
        kind: RoleBinding
        metadata:
        name: {{ .Name }}-dev
        namespace: {{ .Name }}-dev
        roleRef:
        apiGroup: rbac.authorization.k8s.io
        kind: ClusterRole
        name: admin
        subjects:
        - kind: Group
        apiGroup: rbac.authorization.k8s.io
        name: {{ .Name }} 
```
```
kind: Group
apiVersion: user.openshift.io/v1
metadata:
  name: AI_Team
  labels:
    type: devproject
    projectname: saleslearning
```
## Installation
